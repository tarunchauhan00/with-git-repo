<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Docs Admin</title>
  <base href="/" />
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    #nc-root { margin-top: 2rem; }
  </style>
</head>
<body>

  <h2>üõ†Ô∏è Documentation Editor</h2>
  <div id="nc-root"></div>

  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script src="https://unpkg.com/netlify-cms@^2.10.0/dist/netlify-cms.js"></script>
  <script>
    // Grab the raw repo param
    const params = new URLSearchParams(window.location.search);
    const raw = params.get('repo');
    if (!raw) {
      document.body.innerHTML = '<p style="color:red;">No repo specified. Go back and enter a repo URL.</p>';
      throw new Error('Missing repo parameter');
    }

    // Normalize ‚Äúfull URL‚Äù ‚Üí ‚Äúowner/name‚Äù
    function normalize(input) {
      try {
        const u = new URL(input);
        return u.pathname.slice(1).replace(/\.git$/, '');
      } catch {
        return input.replace(/(^\/|\.git$)/g, '');
      }
    }
    const repo = normalize(decodeURIComponent(raw));

    // Init Netlify Identity for login
    netlifyIdentity.init({ open_signup: true });
    netlifyIdentity.on('init', user => { if (!user) netlifyIdentity.open('login'); });

    // Build dynamic CMS config
    const config = {
      backend: {
        name: 'github',
        repo: repo,              // user‚Äësupplied ‚Äúowner/name‚Äù
        branch: 'main',
        auth_type: 'implicit',
        app_id: '<YOUR_GITHUB_OAUTH_APP_CLIENT_ID>'
      },
      media_folder: 'docs/images',
      public_folder: '/images',
      collections: [{
        name: 'pages',
        label: 'Pages',
        folder: 'docs',
        create: true,
        slug: '{{slug}}',
        fields: [
          { label: 'Title', name: 'title', widget: 'string' },
          { label: 'Body',  name: 'body',  widget: 'markdown' }
        ]
      }]
    };

    // Launch the CMS
    CMS.init({ config });
  </script>
</body>
</html>
